<script>
  const TABLET_WIDTH = 991;
  const PERFECT_IMAGE_ACTIVE_CLASS = "active";
  const imageBlockIds = [
    "carclick",
    "fssp",
    "film",
    "incognito",
    "trainet",
    "cinan",
    "pikemedia",
    "ebucks",
    "serviko",
    "stroypark",
    "ebucks2",
  ];

  async function loadSwiperScript() {
    return new Promise((e, i) => {
      const n = document.createElement("script");
      (n.src = "https://unpkg.com/swiper@11.1.1/swiper-bundle.min.js"),
        (n.async = !0),
        (n.onload = e),
        (n.onerror = i),
        document.head.appendChild(n);
    });
  }

  function initializeSwiperWowCases() {
    new Swiper("#wow-cases-swiper", {
      slidesPerView: 1,
      grabCursor: true,
      slidesPerGroup: 1,
      a11y: false,
      spaceBetween: 100,
      autoHeight: false,
      speed: 500,
      loop: true,
      navigation: {
        nextEl: "#wow-cases-swiper-nav-next",
        prevEl: "#wow-cases-swiper-nav-prev",
      },
      pagination: {
        el: ".pagination",
        clickable: true,
      },
    });
  }

  function initializeSwiperStages() {
    new Swiper("#stages-swiper", {
      slidesPerView: 2,
      grabCursor: true,
      slidesPerGroup: 1,
      a11y: false,
      spaceBetween: 60,
      autoHeight: false,
      speed: 500,
      loop: true,
      breakpoints: {
        320: {
          slidesPerView: 1,
          spaceBetween: 30,
        },
        700: {
          slidesPerView: 2,
          spaceBetween: 30,
        },
        992: {
          slidesPerView: 1,
          spaceBetween: 30,
        },
        1100: {
          slidesPerView: 2,
          spaceBetween: 30,
        },
        1280: {
          slidesPerView: 2,
          spaceBetween: 60,
        },
      },
      navigation: {
        nextEl: "#stages-swiper-nav-next",
        prevEl: "#stages-swiper-nav-prev",
      },
      pagination: {
        el: ".pagination",
        clickable: true,
      },
    });
  }

  function replaceImage(imageBlock) {
    const images = imageBlock.childNodes;
    let isClassReplaced = false;

    images.forEach((image, index) => {
      const isHasActiveClass = image.classList.contains(
        PERFECT_IMAGE_ACTIVE_CLASS
      );

      if (isHasActiveClass && !isClassReplaced) {
        image.classList.remove(PERFECT_IMAGE_ACTIVE_CLASS);

        if (images.length === index + 1) {
          images[0].classList.add(PERFECT_IMAGE_ACTIVE_CLASS);
        } else {
          images[index + 1].classList.add(PERFECT_IMAGE_ACTIVE_CLASS);
          isClassReplaced = true;
        }
      }
    });
  }

  document.addEventListener("DOMContentLoaded", async function () {
    await loadSwiperScript();
    initializeSwiperWowCases();
    initializeSwiperStages();
  });

  document.addEventListener("DOMContentLoaded", function () {
    let form = document.getElementById("header-form");
    form.addEventListener("submit", function (event) {
      ym(49180180, "reachGoal", "form_header_send", {
        form_header_send_url: window.location.href,
      });
    });
  });

  document.addEventListener("DOMContentLoaded", function () {
    let form = document.getElementById("footer-form");
    form.addEventListener("submit", function (event) {
      ym(49180180, "reachGoal", "form_footer_send", {
        form_footer_url: window.location.href,
      });
    });
  });

  document.addEventListener("DOMContentLoaded", () => {
    const header = document.getElementById("transparentHeader");
    const heroSection = document.getElementById("hero");
    const heroSectionHeight = heroSection.clientHeight;
    const headerHeight = header.clientHeight;

    function scrollPage() {
      const windowScroll = document.documentElement.scrollTop;
      const isHeroInvisible = windowScroll >= heroSectionHeight - headerHeight;
      const isHeroContainTransparent = header.classList.contains("transparent");

      if (isHeroInvisible && isHeroContainTransparent) {
        header.classList.remove("transparent");
        header.style.backgroundColor = "white";
      }

      if (!isHeroInvisible && !isHeroContainTransparent) {
        header.classList.add("transparent");
        header.style.backgroundColor = "rgba(0, 0, 0, 0)";
      }
    }

    document.addEventListener("scroll", scrollPage);
    scrollPage();
  });

  document.addEventListener("DOMContentLoaded", () => {
    const tabsBlock = document.getElementById("wowCasesTabs");
    let left = 0;
    let drag = false;
    let coorX = 0;

    function mouseDown(e) {
      drag = true;
      coorX = e.pageX - tabsBlock.offsetLeft;
      tabsBlock.style.cursor = "grabbing";
    }

    function scrollOut() {
      drag = false;
      left = tabsBlock.scrollLeft;
      tabsBlock.style.cursor = "grab";
    }

    function mouseMove(e) {
      if (drag) {
        tabsBlock.scrollLeft = left - (e.pageX - tabsBlock.offsetLeft - coorX);
      }
    }

    tabsBlock.addEventListener("mouseup", scrollOut);
    tabsBlock.addEventListener("mouseleave", scrollOut);
    tabsBlock.addEventListener("mousedown", mouseDown);
    tabsBlock.addEventListener("mousemove", mouseMove);
  });

  document.addEventListener("DOMContentLoaded", () => {
    const windowWidth = window.innerWidth;

    if (windowWidth > TABLET_WIDTH) {
      imageBlockIds.forEach((imageBlockId) => {
        const imageBlock = document.getElementById(imageBlockId);

        imageBlock.addEventListener(
          "mouseleave",
          replaceImage.bind(this, imageBlock)
        );
      });
    }
  });
</script>
