## Инструкция по обновлению PROD репозитория

### Подготовительные работы (опционально)

Если вы занимаетесь обновлением PROD репозитория впервые, то следует поделать следующие шаги:

1. Клонируем PROD репозиторий [https://tarkett.gitlab.yandexcloud.net/tarkett-rus/front/is-front/is-beta.git](https://tarkett.gitlab.yandexcloud.net/tarkett-rus/front/is-front/is-beta.git);
2. Так как DEV репозиторий не подключен к PROD, то прописываем в терминале следующую команду `git remote add <name> <url>`, где:
   - `name` - наименование удаленного репозитория (в нашем случае `is-beta`);
   - `url` - ссылка на удаленный репозиторий (указана в первом пункте).

После этого следует проверить ветку `master` PROD'a на наличие обновлений. Чтобы это понять, следует посмотреть историю коммитов и если существуют сторонние. Далее концепция может пойти по двум направлениям:

- Есть обновления на PROD'e;
- Обновления на проде отсутствуют.

### На PROD'e есть обновления

Когда на проде присутствуют обнвления, то наша задача сначала сводится к тому, чтобы запушить эти изменения на DEV репозиторий. Для этого делаем следуюшие шаги:

1. На PROD репозитории подтягиваем изменения с `master` ветки в `development`;
2. Откалываемся от `development` и эту ветку мы будем пушить на DEV.
3. Переходим на ветку с обновлениями и добавляем ссылку на DEV репозиторий посредством `git remote add <name> <url>`, где:
   - `name` - "tarkett-front";
   - `url` - [http://dev.pyrobyte.ru/git/tarkett-front.git](http://dev.pyrobyte.ru/git/tarkett-front.git).
4. Переходим на ветку с обновлениями и в терминале вводим команду `git push <name>`, где `name` - "tarkett-front".
5. Переходим на DEV репозиторий и фетчим его для обновления. Находим нашу ветку с обновлениями и переходим на нее. Открываем терминал и прописываем команду `npm run development-build`. Необходимо это для того что бы переключить api с PROD режима на DEV.
6. Сливаем данную ветку с `master` веткой DEV. Для этого переходим в ветку `master` и пишем команду в терминале `git merge --allow-unrelated-histories --squash <name>` - где name это наименование ветки с обновлениями. Данная команда служит для того, чтобы объеденить ветки, которые не имеют общего предка. [Подробнее](https://runebook.dev/ru/docs/git/git-merge).
7. Далее разрешаем конфликты слияния. После решения не спешим пушить изменения и с помощью команды `amend` откатываем коммит слияния и изменяем в нём наименование и описание. После чего пушим изменения.

### На PROD'e отсутствуют обновления

1. Переходим на ветку с обновлениями на DEV репозитории и вводим команду `npm run change-version --old-version=<old-version-number> --new-version=<new-version-number>`, где:

   - `old-version-number` - старая версия (напрмер 1.58.0);
   - `new-version-number` - новая версия (напрмер 1.59.0).

2. После вводим команду в терминале `git push <name>` - где `name` это отображаемое наименование для удалённого репозитория (в нашем случае "is-beta").
3. Далее переходим на PROD репозиторий и фетчим его на наличие обновлений. Находим ветку, которую запушили и прописываем в терминале команду `npm run production-build` необходимо это для того, чтобы переключить api с DEV режима на PROD.
4. Сливаем данную ветку с `development`. Для этого переходим на `development` и в терминале вводим команду `git merge --allow-unrelated-histories --squash <name>`, где `name` - наименование ветки с обновлениями.
5. Решаем конфликты слияния. После решения конфликтов пользуемся командой `amend` для откатывания коммита слияния, изменения наименования и описания. Только после этого пушим измения.
6. Завершающим этапом будет отправка МР. Переходим в гитлаб [https://tarkett.gitlab.yandexcloud.net/tarkett-rus/front/is-front/is-beta/-/tree/master](https://tarkett.gitlab.yandexcloud.net/tarkett-rus/front/is-front/is-beta/-/tree/master) и создаем МР `development` в `master`. Выбираем ревьюером мр'а "@denis-mironov" ставим флаг "approved" и отправляем мр.
